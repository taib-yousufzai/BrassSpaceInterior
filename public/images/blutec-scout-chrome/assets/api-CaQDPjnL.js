const l="https://blutec-scout-be.blutec.ai/api",w=async t=>new Promise(e=>{chrome.storage.local.set({authToken:t},()=>{e()})}),g=async()=>new Promise(t=>{chrome.storage.local.get(["authToken"],e=>{t(e.authToken||null)})}),i=async()=>new Promise(t=>{chrome.storage.local.remove(["authToken"],()=>{t()})}),h=async t=>new Promise(e=>{chrome.storage.local.set({userData:t},()=>{e()})}),m=async()=>new Promise(t=>{chrome.storage.local.get(["userData"],e=>{t(e.userData||null)})}),u=async()=>new Promise(t=>{chrome.storage.local.remove(["userData"],()=>{t()})}),a=async t=>new Promise(e=>{chrome.storage.local.set({subscriptionStatus:t},()=>{e()})}),y=async()=>new Promise(t=>{chrome.storage.local.get(["subscriptionStatus"],e=>{t(e.subscriptionStatus!==void 0?e.subscriptionStatus:null)})}),s=async(t,e={})=>{const o=await g(),r={"Content-Type":"application/json",...e.headers};o&&(r.Authorization=`Bearer ${o}`);const n=await fetch(`${l}${t}`,{...e,headers:r}),c=await n.json();if(!n.ok)throw new Error(c.message||"API request failed");return c},d=async(t,e,o)=>{try{const r=await s("/auth/extension-login",{method:"POST",body:JSON.stringify({email:t,name:e,picture:o})});return r.success&&(await w(r.token),await h(r.user),await a(r.user.subscription_status)),r}catch(r){throw console.error("Extension login error:",r),r}},p=async()=>{try{const t=await s("/auth/verify-token",{method:"GET"});return t.success&&t.user&&(await h(t.user),await a(t.user.subscription_status)),t}catch(t){throw console.error("Verify token error:",t),t}},b=async()=>{try{const t=await s("/auth/check-subscription",{method:"GET"});return t.success&&await a(t.subscription_status),t}catch(t){throw console.error("Check subscription error:",t),t}},S=async()=>{try{const t=await s("/auth/logout",{method:"POST"});return t.success&&(await i(),await u(),await chrome.storage.local.remove(["subscriptionStatus"])),t}catch(t){throw console.error("Logout error:",t),await i(),await u(),await chrome.storage.local.remove(["subscriptionStatus"]),t}},k=async()=>{try{return await s("/settings",{method:"GET"})}catch(t){throw console.error("Get settings error:",t),t}},f=async t=>{try{return await s("/settings",{method:"PUT",body:JSON.stringify(t)})}catch(e){throw console.error("Update settings error:",e),e}};export{m as a,y as b,u as c,b as d,d as e,k as f,g,S as l,i as r,f as u,p as v};
